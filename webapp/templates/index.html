<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EpicService</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#x1F4E6;</text></svg>">
    
    <!-- PWA Detection and Telegram Integration (MUST BE FIRST!) -->
    <script src="/static/pwa-redirect.js"></script>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EpicService">
    <meta name="description" content="–°–∏—Å—Ç–µ–º–∞ –æ–±–ª—ñ–∫—É —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø—á–∞—Å—Ç–∏–Ω">

    <!-- Manifest -->
    <link rel="manifest" href="/static/manifest.json">

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/icon-192x192.png">

    <!-- PWA Styles -->
    <link rel="stylesheet" href="/static/pwa-styles.css">
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Filters Sidebar -->
    <link rel="stylesheet" href="/static/filters-sidebar.css">
    <script src="/static/filters-sidebar.js"></script>
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="pull-indicator" id="pullIndicator">‚Üì –ü–æ—Ç—è–≥–Ω—ñ—Ç—å –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</div>
    <div class="sticky-container">
        <div class="header">
            <h1>üì¶ EpicService</h1>
            <p id="userInfo">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
            <div class="department-info" id="departmentInfo">
                üè¢ <strong>–í—ñ–¥–¥—ñ–ª:</strong> <span id="currentDepartment">-</span> (<span id="itemCount">0</span> —Ç–æ–≤–∞—Ä—ñ–≤)<br>
                üîí <span style="color: #ff9500">–ú–æ–∂–Ω–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑ —Ü—å–æ–≥–æ –≤—ñ–¥–¥—ñ–ª—É</span>
            </div>
        </div>
        <div class="search-box" id="searchBoxContainer">
            <input type="text" id="searchInput" class="search-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞—Ä—Ç–∏–∫—É–ª –∞–±–æ –Ω–∞–∑–≤—É...">
        </div>
        <div class="tabs">
            <button class="tab active" onclick="switchTab('search')">üîç –ü–æ—à—É–∫</button>
            <button class="tab" onclick="switchTab('list')">üìã –°–ø–∏—Å–æ–∫<span class="tab-badge" id="listBadge" style="display:none">0</span></button>
            <button class="tab" onclick="switchTab('archives')">üìÅ –ê—Ä—Ö—ñ–≤</button>
            <button class="tab hidden" id="adminTabBtn" onclick="switchTab('admin')">üõ†Ô∏è –ê–¥–º—ñ–Ω</button>
        </div>
    </div>

    <div class="main-content">
        <div id="searchTab" class="content active">
            <div id="searchResults"></div>
        </div>
        <div id="listTab" class="content">
            <div id="listContent"></div>
        </div>
        <div id="archivesTab" class="content">
            <div id="statisticsCard"></div>
            <div id="archivesContent"></div>
        </div>
        
        <!-- Admin Tab -->
        <div id="adminContent" class="content">
            <div class="admin-stats-grid" id="adminStatsGrid">
                <div class="loader">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
            
            <div class="admin-section-title">üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –∞–∫—Ç–∏–≤–Ω–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏</div>
            <div id="adminActiveUsers">
                <div class="loader">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
            
            <div class="admin-section-title">üì• –Ü–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä—ñ–≤</div>
            <div id="importAlert"></div>
            <div class="file-upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üìÅ</div>
                <div style="font-size: 15px; margin-bottom: 6px;">–û–±–µ—Ä—ñ—Ç—å Excel —Ñ–∞–π–ª –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É</div>
                <div style="color: var(--hint-color); font-size: 13px;">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ .xlsx, .xls</div>
                <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleFileSelect(event)">
            </div>
            <div id="fileInfo" style="display: none; margin-bottom: 12px; font-size: 14px; color: var(--button-color);"></div>
            <div class="checkbox-group" style="margin-bottom: 12px;">
                <input type="checkbox" id="notifyUsers">
                <label for="notifyUsers">üì¢ –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø—Ä–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</label>
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="uploadFile()" id="uploadBtn" disabled>üì§ –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏</button>
                <button class="btn btn-danger" onclick="cancelUpload(true)">‚úñÔ∏è –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
            
            <div class="admin-section-title">üì§ –ï–∫—Å–ø–æ—Ä—Ç —Ç–∞ –æ–ø–µ—Ä–∞—Ü—ñ—ó</div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showAdminArchives()">üóÑ –ê—Ä—Ö—ñ–≤–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</button>
                <button class="btn btn-secondary" style="background: #8e8e93;" onclick="exportStock()">üìä –ó–≤—ñ—Ç –ø—Ä–æ –∑–∞–ª–∏—à–∫–∏ (Excel)</button>
            </div>
            
            <div class="admin-section-title">üì¢ –†–æ–∑—Å–∏–ª–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</div>
            <div id="broadcastAlert"></div>
            <div class="form-group">
                <label class="form-label">–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</label>
                <textarea class="form-textarea" id="broadcastMessage" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤..."></textarea>
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="sendBroadcast()">üì§ –†–æ–∑—ñ—Å–ª–∞—Ç–∏ –≤—Å—ñ–º</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="success-icon">‚úÖ</div>
            <div class="success-title">–°–ø–∏—Å–æ–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!</div>
            <div class="success-subtitle">–§–∞–π–ª –¥–æ—Å—Ç—É–ø–Ω–∏–π –≤ —Ä–æ–∑–¥—ñ–ª—ñ "–ê—Ä—Ö—ñ–≤"</div>
            <button class="add-btn" style="margin-top:0" onclick="goToArchives()">üìÅ –í—ñ–¥–∫—Ä–∏—Ç–∏ –ê—Ä—Ö—ñ–≤</button>
            <button class="add-btn cancel-btn" onclick="startNewSearch()">üîç –ù–æ–≤–∏–π –ø–æ—à—É–∫</button>
        </div>
    </div>
    
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle"></h2>
            <p id="modalPrice"></p>
            <p id="modalAvailable"></p>
            <div class="quick-actions" style="margin-top:16px">
                <button class="quick-btn" onclick="addAllAvailable()">‚ûï –î–æ–¥–∞—Ç–∏ –≤—Å–µ</button>
                <button class="quick-btn" onclick="showCustomInput()">üî¢ –Ü–Ω—à–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å</button>
            </div>
            <div id="customInputBox" style="display:none">
                <input type="number" id="customQtyInput" class="custom-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å" min="1">
                <button class="add-btn" style="margin-top:0" onclick="applyCustomQty()">‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
            </div>
            <div id="normalSelector">
                <div class="quantity-selector">
                    <button class="qty-btn" onclick="changeQty(-1)">‚àí</button>
                    <div class="qty-display" id="qtyDisplay">1</div>
                    <button class="qty-btn" onclick="changeQty(1)">+</button>
                </div>
                <button class="add-btn" style="margin-top:0" onclick="confirmAdd()">üõí –î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É</button>
            </div>
            <button class="add-btn cancel-btn" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>
    
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2 id="editModalTitle"></h2>
            <p id="editModalPrice"></p>
            <div class="quantity-selector">
                <button class="qty-btn" onclick="changeEditQty(-1)">‚àí</button>
                <div class="qty-display" id="editQtyDisplay">1</div>
                <button class="qty-btn" onclick="changeEditQty(1)">+</button>
            </div>
            <button class="add-btn" style="margin-top:0" onclick="confirmUpdate()">‚úÖ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
            <button class="add-btn delete-btn" onclick="confirmDelete()">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
            <button class="add-btn cancel-btn" onclick="closeEditModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>
    
    <div id="statsModal" class="modal">
        <div class="modal-content" id="statsModalContent"></div>
    </div>
    
    <div id="adminArchivesModal" class="modal">
        <div class="modal-content" id="adminArchivesModalContent"></div>
    </div>
    
    <div class="total-box" id="totalBox" style="display:none">
        <div class="total-text">–í—Å—å–æ–≥–æ: <span id="totalSum">0</span> –≥—Ä–Ω</div>
        <div style="font-size:14px; color:var(--hint-color)"><span id="totalItems">0</span> —Ç–æ–≤–∞—Ä—ñ–≤</div>
    </div>

    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="pwa-install-banner" style="display: none;">
        <div class="pwa-install-content">
            <span>üì± –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Epic Service –Ω–∞ —Å–≤—ñ–π —Ç–µ–ª–µ—Ñ–æ–Ω!</span>
            <button id="pwa-install-btn" class="btn btn-primary">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏</button>
            <button onclick="document.getElementById('pwa-install-banner').style.display='none'" class="btn btn-secondary">–ü—ñ–∑–Ω—ñ—à–µ</button>
        </div>
    </div>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator">
        ‚ö†Ô∏è –ù–µ–º–∞—î –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
    </div>

    <!-- PWA Scripts -->
    <script src="/static/pwa-install.js"></script>

    <!-- Pass ADMIN_IDS to frontend -->
    <script>
        window.ADMIN_IDS_FROM_TEMPLATE = {{ admin_ids | tojson }};
    </script>

    <!-- Load JS Modules in correct order -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/telegram.js"></script>
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/search.js"></script>
    <script src="/static/js/modals.js"></script>
    <script src="/static/js/list.js"></script>
    <script src="/static/js/archives.js"></script>
    <script src="/static/js/admin.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>